name: CI-Pipeline
on: workflow_dispatch
jobs:
    buildandTest:
        runs-on: ubuntu-latest
        services:
            mysql:
                image: mysql:8.0
                env:
                 MYSQL_ROOT_PASSWORD: admin
                 MYSQL_DATABASE: todo_db
                ports:
                -   3306:3306
                options: >-
                     --health-cmd="mysqladmin ping --silent"
                     --health-interval=10s
                     --health-timeout=5s
                     --health-retries=5  
        steps:
        -   name: Checkout Repo
            uses: actions/checkout@v3
        -   name: Node setup
            uses: actions/setup-node@v4
            with:
                node-version: '20.x'
        -   name: Install Dependencies
            run: npm install
        -   name: Import schema
            run: |
                    mysql -h127.0.0.1 -uroot -padmin todo_db < setup.sql
        -   name: Running Backend
            run: node backend/server.js